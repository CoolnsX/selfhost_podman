[Unit]
Description=Nextcloud DB Container

[Container]
Pod=nextcloud.pod
ContainerName=nextcloud_db
Image=docker.io/library/mariadb:lts
Exec=--transaction-isolation=READ-COMMITTED --log-bin=binlog --binlog-format=ROW --socket=${MARIADB_HOST} --skip-networking

# Enable auto-update container
AutoUpdate=registry

# Timezone
Environment=TZ=${TZ}

# DB credentials
Environment=MARIADB_ROOT_PASSWORD=${MARIADB_ROOT_PASSWORD}
Environment=MARIADB_PASSWORD=${MARIADB_PASSWORD}
Environment=MARIADB_DATABASE=${MARIADB_DATABASE}
Environment=MARIADB_USER=${MARIADB_USER}

Volume=%h/podman/nextcloud/db:/var/lib/mysql

[Service]
# pass this to autofill above variables
EnvironmentFile=%h/.config/containers/systemd/nextcloud/.env
Restart=always
TimeoutStartSec=300

[Install]
WantedBy=default.target

